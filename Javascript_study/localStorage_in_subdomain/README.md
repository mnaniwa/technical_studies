localStorage に格納された内容を、サブドメイン跨いで共有したくなった時。

例えば、
> python -m http.server 9000 --bind 127.0.0.1

とかでローカルで sender.html を開いていたとする。方や

> python -m http.server 8000 --bind 127.0.0.1

で receiber.html を開いていたとする。この２つのファイル間ではポート番号が違うためにブラウザの localStorage の内容は共有できない。

これはポート番号が違うからという訳ではなく、別ホストであっても話は同じ。セキュリティを確保するための「同一オリジンポリシー」による制限であり、良くある話でもある。

ただ、要件によってはサブドメインまたいで localStorage の情報を共有したいよねって話も出てくる訳で、そういう時にはどうするか。

今回は iframe で sender.html を開いた後に postMessage でサブドメインとの間で情報のやり取りを行う。動作検証のために直接 localStorage の中身を渡してるけど、セキュリティ的には微妙なので、本番で使う時はもっとちゃんと検証すること。

あと、同じくセキュリティの理由で origin の確認は必須である。
